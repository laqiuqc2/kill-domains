# Windows EXE 编译指南

本指南说明如何在 Mac 系统上为 Windows 编译 exe 文件。

## 方案一：使用 GitHub Actions（推荐）⭐

这是最简单的方法，无需本地 Windows 环境。

### 步骤：

1. **将代码推送到 GitHub**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin <your-github-repo-url>
   git push -u origin main
   ```

2. **触发 GitHub Actions 构建**
   - 推送到 GitHub 后，GitHub Actions 会自动开始构建
   - 或者访问 GitHub 仓库的 Actions 页面，手动触发 workflow

3. **下载编译好的 exe**
   - 构建完成后，在 Actions 页面下载 `DomainKiller-exe` artifact
   - 解压后即可获得 `DomainKiller.exe`

### 优点：
- ✅ 无需 Windows 环境
- ✅ 自动化构建
- ✅ 每次推送代码自动构建

## 方案二：使用 Windows 虚拟机

### 步骤：

1. **安装 Windows 虚拟机**
   - 使用 Parallels Desktop、VMware Fusion 或 VirtualBox
   - 安装 Windows 10/11

2. **在虚拟机中设置环境**
   ```powershell
   # 安装 Python 3.11
   # 从 python.org 下载安装包
   
   # 安装依赖
   pip install -r requirements.txt
   pip install pyinstaller
   ```

3. **编译 exe**
   ```bash
   # 方法一：使用 build.spec
   pyinstaller build.spec
   
   # 方法二：使用 build_exe.py
   python build_exe.py
   
   # 方法三：直接命令
   pyinstaller --onefile --windowed --name=DomainKiller --add-data="domains.txt;." kill_domains.py
   ```

4. **获取 exe 文件**
   - 编译完成后，exe 文件位于 `dist/DomainKiller.exe`
   - 将 exe 文件复制到 Mac 或直接使用

## 方案三：使用远程 Windows 服务器

如果你有 Windows 服务器或远程桌面访问权限：

1. **将项目文件上传到 Windows 服务器**
   - 使用 scp、FTP 或其他方式

2. **在服务器上编译**
   ```powershell
   pip install -r requirements.txt
   pip install pyinstaller
   pyinstaller build.spec
   ```

3. **下载编译好的 exe**

## 方案四：使用 Wine（不推荐）

Wine 可以在 Mac 上运行 Windows 程序，但可能不稳定。

### 步骤：

1. **安装 Wine**
   ```bash
   brew install --cask wine-stable
   ```

2. **在 Wine 中安装 Python**
   - 下载 Windows 版本的 Python 安装包
   - 使用 Wine 运行安装包

3. **编译**
   ```bash
   wine python.exe -m pip install -r requirements.txt
   wine python.exe -m pip install pyinstaller
   wine python.exe -m PyInstaller build.spec
   ```

### 缺点：
- ⚠️ 可能不稳定
- ⚠️ 某些依赖可能无法正常工作
- ⚠️ 编译过程可能失败

## 编译选项说明

### build.spec 配置说明

- `--onefile`: 打包成单个 exe 文件
- `--windowed`: 隐藏控制台窗口（无窗口模式）
- `--name=DomainKiller`: 输出文件名
- `--add-data="domains.txt;."`: 将 domains.txt 包含在 exe 中
- `console=False`: 不显示控制台窗口

### 添加图标

如果想为 exe 添加自定义图标：

1. 准备一个 `.ico` 格式的图标文件（如 `icon.ico`）
2. 修改 `build.spec` 文件：
   ```python
   icon='icon.ico',  # 在 EXE() 部分
   ```
3. 或者在命令行中添加：
   ```bash
   --icon=icon.ico
   ```

## 测试编译结果

编译完成后，建议在 Windows 环境中测试：

1. **以管理员身份运行** exe 文件
2. **检查系统托盘**是否显示图标
3. **测试功能**：
   - 右键托盘图标，点击"立即同步"
   - 检查 hosts 文件是否被修改
   - 测试"恢复访问"功能

## 常见问题

### Q: 编译后的 exe 文件很大？

A: 这是正常的，PyInstaller 会将 Python 解释器和所有依赖打包进去。可以使用 UPX 压缩（已在 build.spec 中启用）。

### Q: exe 被杀毒软件报毒？

A: 这是误报，因为程序会修改 hosts 文件。可以：
- 添加白名单
- 使用代码签名证书签名 exe（需要购买证书）

### Q: 编译失败，提示缺少模块？

A: 确保所有依赖都已安装：
```bash
pip install -r requirements.txt
```

### Q: 在 Mac 上能直接运行吗？

A: 不能，这是 Windows 专用程序。必须在 Windows 环境中运行。

## 推荐工作流程

对于在 Mac 上开发的场景，推荐使用 **GitHub Actions**：

1. 在 Mac 上开发代码
2. 推送到 GitHub
3. GitHub Actions 自动编译
4. 下载编译好的 exe
5. 在 Windows 上测试和使用

这样既方便又可靠！

